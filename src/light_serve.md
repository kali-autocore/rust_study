# 红绿灯服务中心

## 简介

自的动驾驶在某路口的红绿灯信息通过红绿灯自行运行的规则和红绿灯控制中心的信息获取

1. 某路口红绿灯按照某一交通灯规则自行运行
2. 红绿灯管控中心发送某个路口红绿灯的转换规则
3. 本服务根据以上2个动作，得知当前路口红绿灯状态，并将信息通过zenoh发布出去
   
## 功能简介
1. 每隔1s，给红绿灯管控中心发送红绿灯信息
2. 接收红绿灯管控中心命令，调整红绿灯规则
3. 红绿灯信息变更后，更新zenoh中存储的红绿灯信息

## 实现逻辑
Tide+Zenoh
1. 启动服务
2. 读取红绿灯配置文件
3. 服务根据配置文件中红绿灯规则，得出当启动后的红绿灯信息，并发布到对应zenoh的path
4. 服务每隔1s发送红绿灯信息到红绿灯管控中心
5. 红绿灯管控中心发送了某路口新的红绿灯切换规则(如南北走向红绿灯变为红色，时间为60s)到本服务，那么按照收到的规则将当前红绿灯的信息进行调整，并发布到zenoh

## 配置文件内容
1. cross_rood_id 本服务将要应用的红绿灯路口ID，具体值来自于map中的路口ID
2. sn_light 南北方向红绿灯默认灯色，1 绿灯 2 红灯
3. interval 红绿灯切换时间间隔

## API

URL： {url}/rule_change
   
描述：  红绿灯管控中心发送红绿灯变动规则

请求类型： POST

请求内容：
|  字段   | 类型  | 描述  |
|  ----  | ----  | ----  |
| cross_road_id  | string | 十字路口ID |
| sn             | i32    | 南北方向红绿灯状态：1 绿 2 红 3 黄|
| sn_time        | i32    | 南北方向灯剩余时间               |
| ew             | i32    | 东西方向红绿灯状态：1 绿 2 红 3 黄|
| ew_time        | i32    | 东西方向灯剩余时间               |
| timestamp      | i64    | 发送消息的时间戳                |

响应消息：
|  字段    | 类型    | 描述  |
|  ----   | ----    | ----  |
| status  | i32     | 处理状态，1 成功，-1 失败 |
| message | string  | 失败信息描述，成功为空|


## Zenoh 存储
Zenoh 存储path/value

path： 某路口发布的红绿灯存储path，/light/{road_id}/{light_id}
value: 该红绿灯的值，1 绿灯 2 红灯 3 黄灯
